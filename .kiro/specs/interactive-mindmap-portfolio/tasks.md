# Implementation Plan

## Overview

このタスクリストは、インタラクティブなマインドマップ形式のポートフォリオサイトを段階的に実装するための詳細な計画です。各タスクは独立して実行可能で、テスト駆動開発を重視し、既存の実装を拡張する形で進めます。

## 重要な開発環境の注意事項

**Nix環境でのコマンド実行**
- このプロジェクトはNix flakeを使用して開発環境を管理しています
- 全てのRustコマンド（cargo build、cargo test、cargo runなど）はNix環境内で実行する必要があります
- **重要**: `nix develop`を単独で実行すると、Kiro IDEでは終了判定が正しく行われません
- **推奨方法**: `nix develop --command [実行したいコマンド]`の形式でワンライナーとして実行してください

**コマンド実行例**:
```bash
# テスト実行
nix develop --command cargo test

# ビルド実行
nix develop --command cargo build

# 記事処理ツール実行
nix develop --command cargo run --bin process-articles

# 開発サーバー起動
nix develop --command trunk serve

# justコマンド使用
nix develop --command just dev
```

この方式により、Nix環境の依存関係を正しく利用しながら、Kiro IDEでの開発を円滑に進めることができます。

## 実装アプローチ

このプロジェクトでは、既存のコードを最大限活用し、必要最小限の変更で機能を実現することを重視しています。特にタスク7「ノード描画システムの強化」では、以下のアプローチを採用しました：

### 簡素化された実装方針
- **カテゴリ色分け**: 複雑な色分けシステムは実装せず、全ノードを統一色で表示
- **ツールチップ**: 複雑なツールチップシステムは実装せず、シンプルなノード表示に集中
- **既存機能の活用**: レスポンシブ対応、アニメーション、接続線表示などの既存機能をそのまま維持
- **重要度ベースサイズ調整**: 記事の重要度とリンク数に基づく動的ノードサイズ調整に集中

### 技術的な実装詳細
- **NodeComponent**: 重要度とリンク数のプロパティを追加し、動的サイズ計算を実装
- **NodeRegistry**: 重要度とリンク数の管理機能を追加
- **calculate_dynamic_radius**: 重要度レベル（1-5）とインバウンドリンク数に基づくサイズ計算アルゴリズム
- **既存物理演算**: 既存の物理シミュレーションシステムとの統合を維持

## Task List

- [x] 1. 開発環境とプロジェクト構造の整備
  - Nix flakeとjustfileを設定し、統一的な開発環境を構築する
  - 既存のCargo.tomlを拡張してCLIツール用のbinを追加する
  - _Requirements: 全要件の基盤となる開発環境_

- [x] 1.1 Nix開発環境の構築
  - flake.nixを作成してRust toolchain、wasm-pack、trunk、justを含む開発環境を定義する
  - GitHub Actionsで使用するのと同じ依存関係をローカルでも利用可能にする
  - _Requirements: 8.4_

- [x] 1.2 justfileタスクランナーの設定
  - 記事処理、リンク検証、開発サーバー起動などの統一コマンドを定義する
  - ファイル監視機能を含む開発ワークフローを構築する
  - _Requirements: 8.4_

- [x] 1.3 プロジェクト構造の整理
  - 既存のsrc/home/構造を維持しつつ、CLIツール用のsrc/bin/ディレクトリを追加する
  - データ出力用のdata/ディレクトリとarticles/ディレクトリを作成する
  - _Requirements: 5.1, 5.2_

- [x] 1.4 テスト用記事データの作成
  - 開発・テスト用のサンプル記事を作成し、様々なリンクパターンとメタデータを含める
  - 既存のhello.mdを拡張し、相互リンク、タグ、カテゴリを持つ記事セットを構築する
  - _Requirements: 3.1, 3.2, 3.3, 5.3, 5.4_

- [x] 2. 記事処理システムの実装
  - Markdownファイルの解析とFront matter処理を行うRust CLIツールを実装する
  - yaml-front-matterライブラリを使用したfront matter解析とリンク抽出機能を含む
  - _Requirements: 5.1, 5.2, 5.3, 5.6_

- [x] 2.1 yaml-front-matterライブラリを使用したFront matterパーサーの実装
  - yaml-front-matterライブラリを使用してYAML front matterを解析する機能を実装する
  - ArticleMetadata構造体を定義し、デフォルト値の処理を含める
  - front matterのtagsフィールドからタグ情報を取得する機能を実装する
  - テスト用記事データを使用してパーサーの動作を検証する
  - _Requirements: 5.2, 5.6_

- [x] 2.2 Markdownリンク抽出機能の実装
  - 正規表現を使用して[[記事名]]形式と[テキスト](slug)形式のリンクを抽出する
  - リンク周辺のコンテキスト情報も併せて取得する機能を実装する
  - テスト用記事の様々なリンクパターンで抽出機能を検証する
  - _Requirements: 3.1, 3.2, 5.3_

- [x] 2.3 記事処理CLIツールの統合
  - process-articles binを実装し、全ての記事処理機能を統合する
  - yaml-front-matterライブラリとリンク抽出機能を統合する
  - 並行処理とエラーハンドリングを含む堅牢な実装を行う
  - front matterのtagsフィールドのみを使用し、#tag形式の抽出は行わない
  - _Requirements: 5.1, 5.6_

- [x] 3. リンク検証システムの実装
  - 記事間のリンク切れを検出し、構造的問題を報告するシステムを実装する
  - 開発者向けの詳細なエラー報告機能を含む
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [x] 3.1 リンク整合性検証の実装
  - 存在しない記事への参照を検出する機能を実装する
  - Front matterのrelated_articles配列の検証も含める
  - _Requirements: 8.2, 8.3_

- [x] 3.2 バリデーションレポート生成の実装
  - エラーと警告を分類し、詳細なレポートをJSON形式で出力する
  - コンソール出力での開発者フレンドリーな表示も実装する
  - _Requirements: 8.4_

- [x] 3.3 validate-links CLIツールの実装
  - 独立したリンク検証ツールとして実装し、CIでも使用可能にする
  - 既存の記事データを読み込んで検証を行う機能を実装する
  - _Requirements: 8.2, 8.3, 8.4_

- [x] 4. 静的データ生成システムの実装
  - 処理済み記事データとリンクグラフをJSON形式で出力するシステムを実装する
  - フロントエンドで使用する最適化されたデータ構造を生成する
  - _Requirements: 2.2, 3.4, 3.5, 3.6_

- [x] 4.1 記事データJSON生成の実装
  - ProcessedArticle構造体を定義し、記事データをJSON形式で出力する
  - home_display=trueの記事リストも併せて生成する
  - _Requirements: 2.2_

- [x] 4.2 リンクグラフJSON生成の実装
  - 記事間の直接リンク関係を表現するグラフ構造をJSON形式で出力する
  - シンプルな接続情報のみを含める（強度計算は不要）
  - _Requirements: 3.1, 3.2, 3.4_

- [x] 4.3 generate-link-graph CLIツールの実装
  - リンクグラフ生成専用のツールを実装し、直接リンク関係を処理する
  - 双方向リンクの検出を含む（強度計算は不要）
  - _Requirements: 3.1, 3.4_

- [x] 5. フロントエンドデータローダーの実装
  - 事前生成されたJSONファイルを読み込み、既存の物理演算システムと統合する
  - 既存のArticleManager構造を拡張してJSONデータに対応させる
  - _Requirements: 1.1, 1.3, 2.1, 2.2_

- [x] 5.1 DataLoader構造体の実装
  - 静的JSONファイルを非同期で読み込むDataLoader構造体を実装する
  - エラーハンドリングとフォールバック機能を含める
  - _Requirements: 1.1, 1.3_

- [x] 5.2 既存ArticleManagerの拡張
  - 現在のArticleManager構造を拡張してJSONデータソースに対応させる
  - 既存のget_home_articles、get_related_articlesメソッドを維持する
  - _Requirements: 2.1, 2.2_

- [x] 5.3 記事コンテンツの遅延読み込み実装
  - 記事一覧表示時は軽量データのみ読み込み、詳細表示時に本文を読み込む
  - メモリ効率を考慮した実装を行う
  - _Requirements: 1.3_

- [x] 6. 物理演算システムの拡張
  - 既存の物理演算システムを拡張し、事前計算されたリンク強度を活用する
  - 作者ノードを中心とした新しいレイアウト制約を実装する
  - _Requirements: 1.1, 4.1, 4.2, 4.3, 4.4_

- [x] 6.1 作者ノードの実装
  - 中央に固定配置される作者ノードを実装する
  - 作者ノード専用の物理パラメータと描画スタイルを定義する
  - _Requirements: 1.1_

- [x] 6.2 直接リンクベースの物理接続の実装
  - 記事間の直接リンクを物理演算のスプリング接続に変換する
  - デバッグモードで結合力を調整可能なUIを実装する
  - _Requirements: 4.2, 4.3, 7.5_

- [x] 6.3 カテゴリベースのノード配置の実装
  - 同じカテゴリの記事ノードを近くに配置する引力を実装する
  - カテゴリごとの色分けとクラスタリング機能を追加する
  - _Requirements: 7.1, 7.5_

- [x] 6.4 動的ノードサイズ調整の実装
  - 記事の重要度とリンク数に基づいてノードサイズを動的に調整する
  - 物理演算のコライダーサイズも連動して変更する
  - _Requirements: 7.2, 7.3_

- [x] 7. ノード描画システムの強化
  - 既存のノード描画を拡張し、重要度ベースのノードサイズ調整を実装する
  - 既存の接続線表示機能を活用して記事間の関係を視覚化する
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 7.1 重要度ベースノードサイズの実装
  - 記事の重要度レベル（1-5）に応じてノードサイズを動的に調整する機能を実装する
  - インバウンドリンク数（人気度）も考慮したサイズ計算アルゴリズムを実装する
  - 最小・最大サイズ制限（15px-60px）による視覚的階層を確立する
  - _Requirements: 7.1, 7.2_

- [x] 7.2 NodeRegistryの拡張
  - 重要度とインバウンドリンク数を管理するデータ構造を追加する
  - set_node_importance、get_node_importance、set_node_inbound_count、get_node_inbound_countメソッドを実装する
  - サンプルデータで異なる重要度レベルのノードを作成してテストする
  - _Requirements: 7.2_

- [x] 7.3 動的サイズ計算システムの実装
  - calculate_dynamic_radius関数で重要度とリンク数に基づくサイズ計算を実装する
  - 重要度レベル1-5に対応したサイズボーナス計算を行う
  - インバウンドリンク数の平方根を使用した人気度ボーナスを追加する
  - _Requirements: 7.2, 7.3_

- [x] 7.4 既存接続線表示機能の活用
  - 既に実装されているSVGベースの接続線表示機能をそのまま利用する
  - 記事間の直接リンク関係を視覚的な接続線として表示する
  - 既存のレスポンシブ対応とアニメーション機能を維持する
  - _Requirements: 7.4, 7.5_

- [ ] 8. インタラクティブナビゲーションの実装
  - ノードクリック時の記事遷移と関連記事ハイライト機能を実装する
  - 既存のルーティングシステムと統合する
  - _Requirements: 1.3, 3.5, 3.6_

- [ ] 8.1 ノードクリックナビゲーションの実装
  - ノードクリック時に対応する記事ページに遷移する機能を実装する
  - 既存のyew-routerシステムと統合し、スムーズな遷移を実現する
  - _Requirements: 1.3_

- [ ] 8.2 関連記事ハイライト機能の実装
  - 選択されたノードの関連記事を視覚的にハイライトする機能を実装する
  - 関連度に応じたハイライト強度の調整を含める
  - _Requirements: 3.5_

- [ ] 8.3 記事内リンクの動的処理の実装
  - 記事ページ内の[[記事名]]リンクをクリック時にノードグラフにフォーカスする機能を実装する
  - 記事表示とノードグラフ間のシームレスな連携を実現する
  - _Requirements: 3.6_

- [ ] 9. レスポンシブデザインとタッチ対応の実装
  - モバイルデバイス向けのタッチ操作とレスポンシブレイアウトを実装する
  - 既存の物理演算システムをタッチイベントに対応させる
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 9.1 タッチイベントハンドリングの実装
  - タッチによるノードドラッグとピンチズーム機能を実装する
  - 既存のマウスイベントシステムを拡張してタッチに対応させる
  - _Requirements: 6.1, 6.2_

- [ ] 9.2 レスポンシブレイアウトの実装
  - 画面サイズに応じてノードサイズとレイアウトを調整する機能を実装する
  - モバイル向けのUI要素配置最適化を行う
  - _Requirements: 6.2_

- [ ] 9.3 ズームとパン機能の実装
  - ピンチジェスチャーによるズーム機能を実装する
  - タッチによるパン操作と慣性スクロールを追加する
  - _Requirements: 6.3_

- [ ] 10. GitHub Actions統合とCI/CD構築
  - 記事更新時の自動処理ワークフローを構築する
  - Nixを使用した再現可能なCI環境を実装する
  - _Requirements: 8.1, 8.2, 8.4_

- [ ] 10.1 記事処理ワークフローの実装
  - articles/ディレクトリの変更を検出して自動的に記事処理を実行するGitHub Actionsを実装する
  - Nix環境を使用した一貫性のあるCI実行環境を構築する
  - _Requirements: 8.1, 8.4_

- [ ] 10.2 自動デプロイワークフローの実装
  - 記事処理完了後に自動的にWebAssemblyビルドとGitHub Pagesデプロイを実行する
  - ビルド成果物の最適化とキャッシュ機能を含める
  - _Requirements: 8.4_

- [ ] 10.3 開発ワークフローの統合テスト
  - ローカル開発環境とCI環境での一貫性を検証する
  - エンドツーエンドのワークフローテストを実装する
  - _Requirements: 8.4_

- [ ] 11. パフォーマンス最適化と品質向上
  - 大量記事での性能最適化とメモリ効率の改善を実装する
  - 包括的なテストスイートを構築する
  - _Requirements: 全要件の品質保証_

- [ ] 11.1 物理演算パフォーマンス最適化
  - 大量ノードでの物理演算性能を改善する
  - 静止状態ノードの計算スキップとスペース分割最適化を実装する
  - _Requirements: パフォーマンス要件_

- [ ] 11.2 メモリ使用量最適化
  - 記事データの遅延読み込みとキャッシュ管理を最適化する
  - 不要なデータの自動解放機能を実装する
  - _Requirements: パフォーマンス要件_

- [ ] 11.3 包括的テストスイートの実装
  - 記事処理、リンク検証、物理演算の各機能に対するユニットテストを実装する
  - WebAssembly環境でのインテグレーションテストを追加する
  - テスト専用の記事データセットを作成し、エッジケースを含む包括的なテストを実行する
  - _Requirements: 全要件の品質保証_

- [ ] 11.4 アクセシビリティ対応の実装
  - キーボードナビゲーションとスクリーンリーダー対応を実装する
  - WCAG準拠のカラーコントラストと操作性を確保する
  - _Requirements: アクセシビリティ要件_

## テスト用データ作成の詳細

### 1.4 テスト用記事データの構成

#### 基本記事セット（articles/test/）
```markdown
# articles/rust-async.md
---
title: "Rustでの非同期プログラミング"
home_display: true
category: "programming"
importance: 4
related_articles: ["tokio-basics", "async-patterns"]
tags: ["rust", "async", "programming"]
---

# Rustでの非同期プログラミング
[[tokio-basics]]を理解することから始めましょう。
[パターン集](async-patterns)も参考になります。
#rust #async

# articles/tokio-basics.md
---
title: "Tokio入門"
home_display: true
category: "programming"
importance: 3
tags: ["rust", "tokio", "async"]
---

# Tokio入門
[[rust-async]]の基礎となる概念です。
#tokio #rust

# articles/async-patterns.md
---
title: "非同期パターン集"
home_display: false
category: "programming"
importance: 2
tags: ["async", "patterns"]
---

# 非同期パターン集
[[rust-async]]で使える実用的なパターンを紹介。
#patterns #async

# articles/web-development.md
---
title: "Web開発の基礎"
home_display: true
category: "web"
importance: 3
tags: ["web", "frontend", "backend"]
---

# Web開発の基礎
フロントエンドとバックエンドの基本概念。
#web #development

# articles/broken-link-test.md
---
title: "リンク切れテスト"
home_display: false
category: "test"
importance: 1
related_articles: ["non-existent-article"]
tags: ["test"]
---

# リンク切れテスト
[[存在しない記事]]へのリンクでテスト。
[壊れたリンク](broken-slug)
```

#### テストケース
- **相互リンク**: rust-async ↔ tokio-basics
- **一方向リンク**: async-patterns → rust-async
- **タグ記録**: rust, async, programming（関連性計算には使用しない）
- **カテゴリ分類**: programming, web, test
- **重要度レベル**: 1-4の範囲
- **リンク切れ**: 存在しない記事への参照
- **home_display**: true/falseの混在
- **デバッグモード**: 結合力調整のテスト

#### 段階的データ拡張
- **Phase 1**: 基本5記事でコア機能テスト
- **Phase 2**: 10-15記事で中規模テスト
- **Phase 3**: 50+記事でパフォーマンステスト